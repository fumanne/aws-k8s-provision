---

- name: Create kubelet Dir
  file: path={{ item }} state=directory owner=root group=root mode=0755
  with_items:
    - /var/lib/kubelet
    - /etc/cni/net.d

- name: 下载 kubelet
  copy: src={{ item }} dest=/root/local/bin/{{ item }} mode=0755
  with_items:
  - kubelet

- name: 将cni plguin 放入 /opt/cni/bin 下
  copy: src={{ item }} dest=/opt/cni/bin/{{ item }} mode=0755
  with_items:
  - bridge
  - loopback
  - host-local
  - flannel
  - firewall
  - portmap
  - static
  - vlan
  - tuning
  - macvlan


- name: 准备 cni配置文件
  template: src=cni-default.conf.j2 dest=/etc/cni/net.d/10-default.conf

- name: 创建cloud-config
  template: src=aws-cloud-config.j2 dest=/etc/kubernetes/cloud-config

